<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Athletics — Patient Portal | PredictWell Health.ai</title>
  <meta name="description" content="Quick athlete self-check with a simple readiness/injury-risk view." />
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#0a0f1a; --panel:#0f1725ee; --muted:#8aa0b3; --text:#e9f1f7;
      --brand:#63e6be; --brand2:#5aa6ff; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{margin:0;height:100%;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    body::before{content:"";position:fixed;inset:0;background-image:url("/static/images/predictwell_background.png");background-size:cover;background-position:center;filter:brightness(.7);z-index:-2}
    body::after{content:"";position:fixed;inset:0;background:linear-gradient(180deg, rgba(10,15,26,.55), rgba(10,15,26,.85));z-index:-1}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    .top{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .logo{height:22px;width:22px;border-radius:8px;background:linear-gradient(135deg,var(--brand2),var(--brand))}
    h1{margin:0}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-weight:600;font-size:.95rem}
    input,select,textarea{width:100%;padding:11px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
    textarea{min-height:88px;resize:vertical}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .btn{padding:12px 16px;border-radius:14px;border:1px solid transparent;cursor:pointer;font-weight:700}
    .primary{background:linear-gradient(135deg,var(--brand2),var(--brand));color:#07111f}
    .ghost{background:transparent;border-color:rgba(255,255,255,.12);color:#e7f4ff}
    .muted{color:var(--muted);font-size:.95rem}
    .result{margin-top:16px;display:none}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="logo"></div>
      <div><strong>PredictWell Health</strong> · <a href="/">Home</a></div>
    </div>

    <div class="card">
      <h1 style="margin-top:0">Athletics — Patient Check-In</h1>
      <p class="muted">Quick self-check to estimate today’s readiness and short-term injury risk.</p>

      <form id="form" class="grid">
        <div>
          <label>Sport / Position</label>
          <input type="text" id="position" placeholder="e.g., Baseball — Pitcher">
        </div>
        <div>
          <label>Age</label>
          <input type="number" id="age" min="10" max="60" placeholder="e.g., 17">
        </div>
        <div>
          <label>Throws today (count)</label>
          <input type="number" id="throwsToday" min="0" max="400" placeholder="e.g., 35">
        </div>
        <div>
          <label>Last 7-day total throws</label>
          <input type="number" id="throws7d" min="0" max="1500" placeholder="e.g., 220">
        </div>
        <div>
          <label>Pain today</label>
          <select id="pain">
            <option value="none" selected>None</option>
            <option value="mild">Mild</option>
            <option value="moderate">Moderate</option>
            <option value="severe">Severe</option>
          </select>
        </div>
        <div>
          <label>Fatigue today</label>
          <select id="fatigue">
            <option value="low" selected>Low</option>
            <option value="moderate">Moderate</option>
            <option value="high">High</option>
          </select>
        </div>
        <div>
          <label>Sleep last night (hours)</label>
          <input type="number" step="0.1" id="sleep" min="0" max="14" placeholder="e.g., 7.2">
        </div>
        <div>
          <label>Wellness (RPE 1–10)</label>
          <input type="number" id="rpe" min="1" max="10" placeholder="e.g., 6">
        </div>
        <div class="full">
          <label>Notes (optional)</label>
          <textarea id="notes" placeholder="Any tightness, recent workload jump, travel, illness, etc."></textarea>
        </div>
        <div class="full actions">
          <button type="submit" class="btn primary">Get My Result</button>
          <button type="button" id="reset" class="btn ghost">Reset</button>
        </div>
      </form>

      <div id="result" class="result">
        <div class="pill" id="riskBadge">Risk: —</div>
        <p id="summary" style="margin-top:10px"></p>
        <p class="muted" style="margin-top:8px">This quick view is informational, not medical advice. If pain worsens, stop activity and seek care.</p>
      </div>
    </div>
  </div>

  <script>
    const BASE_API = 'https://predictwell-backend-ai.onrender.com';

    const form = document.getElementById('form');
    const resultBox = document.getElementById('result');
    const riskBadge = document.getElementById('riskBadge');
    const summary = document.getElementById('summary');

    document.getElementById('reset').onclick = () => { form.reset(); resultBox.style.display='none'; };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        domain: 'athletics',
        age: num('age'),
        position: document.getElementById('position').value.trim() || null,
        throws_today: num('throwsToday'),
        throws_7d: num('throws7d'),
        pain: val('pain'),
        fatigue: val('fatigue'),
        sleep_hours: num('sleep'),
        rpe: num('rpe'),
        notes: document.getElementById('notes').value?.trim() || null
      };

      // Try generic /risk endpoint first
      let ok = false;
      try {
        const res = await fetch(`${BASE_API}/risk`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (res.ok) {
          const data = await res.json(); // expect { risk_score, level, message } if available
          const level = data.level || levelFromScore(data.risk_score);
          render(level, data.message || autoMessage(payload, level));
          ok = true;
        }
      } catch (err) { /* fall through */ }

      // Fallback local estimate
      if (!ok) {
        const level = localEstimate(payload);
        render(level, autoMessage(payload, level), true);
      }
    });

    function val(id){ return document.getElementById(id).value; }
    function num(id){ const v = document.getElementById(id).value; return v===""?null:Number(v); }

    function levelFromScore(s){
      if (s==null) return 'Unknown';
      if (s >= 0.66) return 'High';
      if (s >= 0.33) return 'Moderate';
      return 'Low';
    }

    function localEstimate(p){
      let score = 0;
      // workload spike
      if (p.throws_7d!=null && p.throws_today!=null && p.throws_today > Math.max(25, 0.35 * p.throws_7d)) score += 0.25;
      // pain / fatigue
      if (p.pain==='moderate') score += 0.25;
      if (p.pain==='severe') score += 0.5;
      if (p.fatigue==='moderate') score += 0.15;
      if (p.fatigue==='high') score += 0.3;
      // sleep & wellness
      if (p.sleep_hours!=null && p.sleep_hours < 6) score += 0.15;
      if (p.rpe!=null && p.rpe >= 8) score += 0.15;

      if (score >= 0.66) return 'High';
      if (score >= 0.33) return 'Moderate';
      return 'Low';
    }

    function autoMessage(p, level){
      const bits = [];
      if (p.pain==='moderate' || p.pain==='severe') bits.push('current pain');
      if (p.fatigue!=='low') bits.push('fatigue');
      if (p.sleep_hours!=null && p.sleep_hours<6) bits.push('short sleep');
      if (p.throws_today!=null && p.throws_7d!=null && p.throws_today > Math.max(25, 0.35*p.throws_7d)) bits.push('workload spike today');
      const because = bits.length ? `Because of ${bits.join(', ')}.` : '';
      return `Your quick risk looks **${level}**. ${because} Adjust workload and recovery accordingly, and tell your coach/clinician if symptoms persist.`;
    }

    function render(level, msg, fallback=false){
      riskBadge.textContent = `Risk: ${level}${fallback ? ' (quick estimate)' : ''}`;
      summary.innerHTML = msg;
      resultBox.style.display = 'block';
      resultBox.scrollIntoView({behavior:'smooth', block:'start'});
    }
  </script>
</body>
</html>

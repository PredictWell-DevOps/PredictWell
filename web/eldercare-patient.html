<!-- ====== eldercare-patient.html (Patient Portal — 12-input + client-side score + visual badge) ====== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PredictWell Health.ai — Eldercare Patient Portal</title>
  <meta name="description" content="Simple 12-question checkup for seniors and caregivers. Instant score + AI insights." />
  <link rel="icon" href="data:,">
  <style>
    :root{ --glass-bg: rgba(255,255,255,0.78); --radius: 18px; --shadow: 0 10px 30px rgba(0,0,0,0.18);
           --blu:#2563eb; --ink:#0b1020; --muted:#374151; --line: rgba(17,24,39,0.08); }
    html, body{ height:100%; margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:#111827; background-image:url("/static/images/predictwell_background.png"); background-size:cover; background-position:center; background-repeat:no-repeat; background-attachment:fixed; }
    .header{ position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.2) blur(6px); background:rgba(255,255,255,0.75); border-bottom:1px solid rgba(255,255,255,0.4); }
    .header-inner{ max-width:1080px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; gap:14px; }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:#0b1020; }
    .brand-logo{ width:34px; height:34px; border-radius:10px; background:linear-gradient(135deg,var(--blu),#60a5fa); box-shadow:var(--shadow); }
    .brand-title{ font-weight:800; letter-spacing:.2px; font-size:20px; line-height:1; }
    .brand-title .hi{ color:#111827; } .brand-title .ai{ color:#000; }
    .brand-tagline{ font-size:12px; color:#4b5563; line-height:1.1; }
    .spacer{ flex:1; }
    .hamburger{ border:none; background:#fff; border-radius:999px; width:36px; height:36px; display:grid; place-items:center; box-shadow:var(--shadow); cursor:pointer; }
    .hamburger:after{ content:"≡"; font-size:20px; color:#111827; position:relative; top:-1px; }
    .menu{ position:absolute; right:18px; top:58px; background:var(--glass-bg); backdrop-filter:blur(10px); border-radius:14px; box-shadow:var(--shadow); padding:8px; display:none; }
    .menu a{ display:block; padding:10px 12px; border-radius:10px; text-decoration:none; color:#111827; min-width:220px; }
    .menu a:hover{ background:rgba(17,24,39,0.06); }

    .wrap{ max-width:760px; margin:28px auto 36px; padding:0 18px; }
    .hero{ background:var(--glass-bg); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px 24px; margin-bottom:18px; }
    .hero h1{ margin:0 0 8px 0; font-size:28px; }
    .hero p{ margin:0; color:var(--muted); }
    .chip{ display:inline-block; padding:6px 10px; border-radius:999px; background:linear-gradient(135deg,#9ca3af,#e5e7eb); color:#000; font-weight:700; font-size:12px; }

    .section{ background:var(--glass-bg); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; margin-top:16px; }
    .section h2{ margin:0 0 14px 0; font-size:18px; letter-spacing:.2px; }

    .grid-2{ display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:12px; }
    .grid-3{ display:grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap:12px; }
    @media (max-width:740px){ .grid-2,.grid-3{ grid-template-columns:1fr; } }

    .field{ display:flex; flex-direction:column; gap:6px; }
    label{ font-size:12px; color:var(--muted); }
    input[type="number"], select{
      width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:12px; background:#fff; font-size:16px; outline:none;
    }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; align-items:center; }
    .btn{ appearance:none; border:none; padding:12px 18px; border-radius:999px; color:#fff; font-weight:800; cursor:pointer; box-shadow:var(--shadow); font-size:16px; }
    .btn-blue{ background:linear-gradient(135deg,#2563eb,#60a5fa); }
    .btn-gray{ background:linear-gradient(135deg,#6b7280,#9ca3af); color:#0b1020; }
    .muted{ color:var(--muted); font-size:12px; }

    /* Results */
    .results-head{ display:flex; align-items:center; gap:12px; margin-bottom:10px; flex-wrap:wrap; }
    .badge{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; font-weight:800; box-shadow:var(--shadow); background:#e5e7eb; color:#0b1020; }
    .badge .dot{ width:10px; height:10px; border-radius:999px; background:#9ca3af; }
    pre.results{ margin:0; padding:14px; background:#0b1020; color:#c7d2fe; border-radius:14px; min-height:160px; overflow:auto; white-space:pre-wrap; word-break:break-word; }

    .footer{ text-align:center; color:#374151; font-size:12px; margin-top:28px; text-shadow:0 1px 0 rgba(255,255,255,0.75); }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a class="brand" href="/index.html" aria-label="Back to PredictWell Health.ai home">
        <div class="brand-logo" aria-hidden="true"></div>
        <div>
          <div class="brand-title"><span class="hi">PredictWell Health</span><span class="ai">.ai</span></div>
          <div class="brand-tagline">Proactive health insights for seniors & athletes</div>
        </div>
      </a>
      <div class="spacer"></div>
      <button class="hamburger" id="menuBtn" aria-label="Open menu"></button>
      <nav class="menu" id="menu">
        <a href="/eldercare.html">Eldercare — Doctors</a>
        <a href="/eldercare-patient.html"><strong>Eldercare — Patients</strong></a>
        <a href="/athletics.html">Athletics — Doctors</a>
        <a href="/athletics-patient.html">Athletics — Patients</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <section class="hero">
      <h1>Eldercare — Patient Checkup</h1>
      <p>Answer these 12 quick questions. You’ll see an instant PredictWell Score and suggestions.</p>
      <div style="margin-top:10px;">
        <span class="chip">Patient Portal</span>
        <span class="chip">12 Questions</span>
        <span class="chip">Instant Results</span>
      </div>
    </section>

    <form id="patientForm" class="section" onsubmit="event.preventDefault(); saveForm();">
      <h2>Your Quick Checkup</h2>
      <div class="grid-2">
        <div class="field"><label for="age">1) Age</label><input id="age" type="number" min="0" step="1" placeholder="e.g., 79" /></div>
        <div class="field"><label for="living">2) Living situation</label>
          <select id="living"><option value="">Select…</option><option>Alone</option><option>With spouse/family</option><option>Assisted living</option></select>
        </div>
        <div class="field"><label for="falls_12m">3) Falls in the past year</label>
          <select id="falls_12m"><option value="">Select…</option><option>0</option><option>1</option><option>2 or more</option></select>
        </div>
        <div class="field"><label for="unsteady">4) Cane/walker or feel unsteady?</label>
          <select id="unsteady"><option value="">Select…</option><option>No</option><option>Sometimes</option><option>Often</option></select>
        </div>
        <div class="field"><label for="fear_fall">5) Are you afraid of falling?</label>
          <select id="fear_fall"><option value="">Select…</option><option>No</option><option>Yes</option></select>
        </div>
        <div class="field"><label for="chair_rise">6) Stand from a chair without using your arms?</label>
          <select id="chair_rise"><option value="">Select…</option><option>Yes, easily</option><option>Yes, but hard</option><option>No</option></select>
        </div>
        <div class="field"><label for="dizzy">7) Dizzy or lightheaded when standing?</label>
          <select id="dizzy"><option value="">Select…</option><option>No</option><option>Occasionally</option><option>Often</option></select>
        </div>
        <div class="field"><label for="med_count">8) About how many daily medicines?</label>
          <select id="med_count"><option value="">Select…</option><option>0–2</option><option>3–4</option><option>5 or more</option></select>
        </div>
        <div class="field"><label for="memory">9) New memory problems or confusion?</label>
          <select id="memory"><option value="">Select…</option><option>No</option><option>Some days</option><option>Most days</option></select>
        </div>
        <div class="field"><label for="mood">10) Mood / emotional health</label>
          <select id="mood"><option value="">Select…</option><option>Good</option><option>Somewhat down/anxious</option><option>Depressed or anxious</option></select>
        </div>
        <div class="field"><label for="activity">11) Physical activity most days</label>
          <select id="activity"><option value="">Select…</option><option>Hardly active</option><option>Lightly active</option><option>Walk/exercise often</option></select>
        </div>
        <div class="field"><label for="home_haz">12) Home safety: throw rugs, poor night lighting, or no grab bars?</label>
          <select id="home_haz"><option value="">Select…</option><option>No</option><option>Yes</option><option>Not sure</option></select>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn btn-blue" id="runBtn">Get Results</button>
        <button type="submit" class="btn btn-gray">Save My Answers</button>
        <span class="muted" id="saveStatus"></span>
        <span class="muted" id="backendStatus" style="margin-left:8px;"></span>
      </div>
    </form>

    <section class="section">
      <div class="results-head">
        <div id="scoreBadge" class="badge" aria-live="polite" aria-atomic="true" style="display:none;">
          <span class="dot" id="scoreDot"></span>
          <span id="badgeText">PredictWell Score</span>
        </div>
        <h2 style="margin:0;">Your Results</h2>
      </div>
      <pre class="results" id="resultsBox">{ "status": "ready" }</pre>
    </section>

    <div class="footer">© 2025 PredictWell Health.ai — Eldercare</div>
  </div>

  <script>
    const BASE_API = 'https://predictwell-backend-ai.onrender.com';

    // Header menu toggle
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    document.addEventListener('click', (e) => {
      if (menuBtn.contains(e.target)) {
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
      } else if (!menu.contains(e.target)) {
        menu.style.display = 'none';
      }
    });

    // Save / Restore
    function saveForm(){
      const ids = ['age','living','falls_12m','unsteady','fear_fall','chair_rise','dizzy','med_count','memory','mood','activity','home_haz'];
      const data = {}; ids.forEach(id => data[id] = document.getElementById(id)?.value ?? '');
      try{ localStorage.setItem('eldercare_patient12', JSON.stringify(data));
        document.getElementById('saveStatus').textContent = 'Saved.';
        setTimeout(()=>{ document.getElementById('saveStatus').textContent=''; }, 2000);
      }catch(e){ document.getElementById('saveStatus').textContent = 'Could not save.';
        setTimeout(()=>{ document.getElementById('saveStatus').textContent=''; }, 2000);
      }
    }
    (function restore(){
      try{ const raw = localStorage.getItem('eldercare_patient12'); if(!raw) return;
        const data = JSON.parse(raw); Object.entries(data).forEach(([id,val])=>{ const el = document.getElementById(id); if(el) el.value = val; });
      }catch(e){}
    })();

    // Map UI -> payload
    function collectPayload(){
      const g = id => document.getElementById(id)?.value || '';
      return {
        source: 'patient_portal_v12',
        age: Number(g('age') || 0),
        living: g('living'),
        falls_12m: g('falls_12m'),
        unsteady: g('unsteady'),
        fear_fall: g('fear_fall'),
        chair_rise: g('chair_rise'),
        dizzy_stand: g('dizzy'),
        med_count: g('med_count'),
        memory_change: g('memory'),
        mood: g('mood'),
        activity: g('activity'),
        home_hazards: g('home_haz')
      };
    }

    // ---------- Client-side scoring (instant) ----------
    function scoreBuckets(score){
      // 0–8 Low, 9–16 Moderate, 17–24 High, 25+ Very High
      if (score >= 25) return { level: 'Very High', color: '#991b1b' };   // red
      if (score >= 17) return { level: 'High', color: '#b45309' };        // amber
      if (score >= 9)  return { level: 'Moderate', color: '#065f46' };    // green
      return { level: 'Low', color: '#1d4ed8' };                          // blue
    }

    function computePredictWellScore(p){
      let s = 0;
      if (p.age >= 85) s += 3; else if (p.age >= 75) s += 2; else if (p.age >= 65) s += 1;
      if (p.living === 'Alone') s += 2; else if (p.living === 'Assisted living') s += 1;
      if (p.falls_12m === '1') s += 2; else if (p.falls_12m === '2 or more') s += 4;
      if (p.unsteady === 'Sometimes') s += 2; else if (p.unsteady === 'Often') s += 4;
      if (p.fear_fall === 'Yes') s += 2;
      if (p.chair_rise === 'Yes, but hard') s += 2; else if (p.chair_rise === 'No') s += 4;
      if (p.dizzy_stand === 'Occasionally') s += 1; else if (p.dizzy_stand === 'Often') s += 3;
      if (p.med_count === '3–4') s += 1; else if (p.med_count === '5 or more') s += 2;
      if (p.memory_change === 'Some days') s += 2; else if (p.memory_change === 'Most days') s += 3;
      if (p.mood === 'Somewhat down/anxious') s += 1; else if (p.mood === 'Depressed or anxious') s += 2;
      if (p.activity === 'Lightly active') s += 1; else if (p.activity === 'Hardly active') s += 2;
      if (p.home_hazards === 'Yes') s += 2; else if (p.home_hazards === 'Not sure') s += 1;
      const bucket = scoreBuckets(s);
      return { score: s, level: bucket.level, color: bucket.color };
    }

    function buildSuggestions(p){
      const sug = [];
      if (p.falls_12m !== '0' && p.falls_12m) sug.push('Discuss recent falls with your doctor; consider a falls clinic evaluation.');
      if (p.unsteady === 'Sometimes' || p.unsteady === 'Often') sug.push('Start balance/strength exercises (sit-to-stand, heel-to-toe); ask about PT.');
      if (p.chair_rise === 'Yes, but hard' || p.chair_rise === 'No') sug.push('Practice safe chair rises; check chair height; consider PT for leg strength.');
      if (p.fear_fall === 'Yes') sug.push('Try short, safe walks with support; review footwear and home lighting.');
      if (p.dizzy_stand === 'Occasionally' || p.dizzy_stand === 'Often') sug.push('Hydrate; stand up slowly; ask about orthostatic BP and meds review.');
      if (p.med_count === '5 or more') sug.push('Ask for a medication review to reduce fall-risk medicines.');
      if (p.memory_change === 'Some days' || p.memory_change === 'Most days') sug.push('Track memory changes; consider a brief cognition screen.');
      if (p.mood === 'Somewhat down/anxious' || p.mood === 'Depressed or anxious') sug.push('Talk about mood; short walks and social time can help.');
      if (p.activity === 'Hardly active') sug.push('Begin a gentle daily walking plan (5–10 minutes).');
      if (p.home_hazards === 'Yes' || p.home_hazards === 'Not sure') sug.push('Remove throw rugs, add night lights, and install bathroom grab bars.');
      if (p.living === 'Alone') sug.push('Set up a daily check-in or wearable alert button.');
      return sug.slice(0, 3);
    }

    // Badge updater
    function updateBadge(local){
      const badge = document.getElementById('scoreBadge');
      const dot = document.getElementById('scoreDot');
      const text = document.getElementById('badgeText');
      badge.style.display = 'inline-flex';
      dot.style.background = local.color;
      text.textContent = `PredictWell Score: ${local.score} — ${local.level}`;
      // Light tint for chip background based on level color
      badge.style.background = '#ffffffcc';
      badge.style.border = `1px solid ${local.color}33`;
      badge.style.color = '#0b1020';
    }

    // Backend status
    async function pingBackend() {
      const badge = document.getElementById('backendStatus');
      try { const r = await fetch(`${BASE_API}/healthz`); await r.json();
        badge.textContent = 'Backend: ok'; badge.style.color = '#065f46';
      } catch(e) { badge.textContent = 'Backend: down'; badge.style.color = '#991b1b'; }
    }
    pingBackend();

    // Run analysis: badge + client JSON, then server merge
    async function runAnalysis(){
      const resultsBox = document.getElementById('resultsBox');
      const payload = collectPayload();

      const local = computePredictWellScore(payload);
      const suggestions = buildSuggestions(payload);
      const localBlock = {
        client_score: local.score,
        client_category: local.level,
        client_suggestions: suggestions
      };

      updateBadge(local);
      resultsBox.textContent = JSON.stringify(localBlock, null, 2);

      try{
        const res = await fetch(`${BASE_API}/eldercare/checkin`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ...payload, client_score: local.score, client_category: local.level })
        });
        const json = await res.json();
        const merged = { ...localBlock, server_response: json };
        resultsBox.textContent = JSON.stringify(merged, null, 2);
      }catch(e){
        const merged = { ...localBlock, server_error: 'Request failed or backend unreachable' };
        resultsBox.textContent = JSON.stringify(merged, null, 2);
      }
    }

    document.getElementById('runBtn').addEventListener('click', runAnalysis);
  </script>
</body>
</html>

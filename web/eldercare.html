<!-- ====== eldercare-patient.html (Patient Portal — matches doctor portal styling) ====== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PredictWell Health.ai — Eldercare Patient Portal</title>
  <meta name="description" content="Simple daily check-in for seniors. We compute a nowcast and a 2–4 week outlook to help you stay safer." />
  <link rel="icon" href="data:,">
  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.78);
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,0.18);
      --blu: #2563eb;
      --ink: #0b1020;
      --muted: #374151;
      --line: rgba(17,24,39,0.08);
      --ok:#065f46; --warn:#92400e; --bad:#7f1d1d;
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: #111827;
      background-image: url("/static/images/predictwell_background.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    /* ----- Header (identical to Doctor page) ----- */
    .header {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: saturate(1.2) blur(6px);
      background: rgba(255,255,255,0.75);
      border-bottom: 1px solid rgba(255,255,255,0.4);
    }
    .header-inner {
      max-width: 1080px; margin: 0 auto; padding: 14px 18px;
      display: flex; align-items: center; gap: 14px;
    }
    .brand { display: flex; align-items: center; gap: 10px; text-decoration: none; color: #0b1020; }
    .brand-logo { width: 34px; height: 34px; border-radius: 10px; background: linear-gradient(135deg, var(--blu), #60a5fa); box-shadow: var(--shadow); }
    .brand-title { font-weight: 800; letter-spacing: 0.2px; font-size: 20px; line-height: 1; }
    .brand-title .hi { color: #111827; } .brand-title .ai { color: #000000; }
    .brand-tagline { font-size: 12px; color: #4b5563; line-height: 1.1; }
    .spacer { flex: 1; }
    .hamburger { border: none; background: #fff; border-radius: 999px; width: 36px; height: 36px; display: grid; place-items: center; box-shadow: var(--shadow); cursor: pointer; }
    .hamburger:after{ content: "≡"; font-size: 20px; color: #111827; position: relative; top: -1px; }
    .menu { position: absolute; right: 18px; top: 58px; background: var(--glass-bg); backdrop-filter: blur(10px); border-radius: 14px; box-shadow: var(--shadow); padding: 8px; display: none; }
    .menu a { display: block; padding: 10px 12px; border-radius: 10px; text-decoration: none; color: #111827; min-width: 220px; }
    .menu a:hover { background: rgba(17,24,39,0.06); }

    /* ----- Page layout ----- */
    .wrap { max-width: 1080px; margin: 28px auto 36px; padding: 0 18px; }
    .hero { background: var(--glass-bg); border-radius: var(--radius); box-shadow: var(--shadow); padding: 22px 24px; margin-bottom: 18px; }
    .hero h1 { margin: 0 0 8px 0; font-size: 32px; }
    .hero p { margin: 0; color: var(--muted); }
    .section { background: var(--glass-bg); border-radius: var(--radius); box-shadow: var(--shadow); padding: 18px; margin-top: 16px; }
    .section h2 { margin: 0 0 14px 0; font-size: 18px; letter-spacing: 0.2px; }
    .grid-2 { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 12px; }
    @media (max-width: 900px){ .grid-2, .grid-3 { grid-template-columns: 1fr; } }

    .field { display: flex; flex-direction: column; gap: 6px; }
    label { font-size: 12px; color: var(--muted); }
    input[type="text"], input[type="number"], select {
      width: 100%; padding: 10px 12px; border: 1px solid var(--line); border-radius: 12px; background: #fff; font-size: 14px; outline: none;
    }
    .inline { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .chip { display: inline-block; padding: 6px 10px; border-radius: 999px; background: linear-gradient(135deg,#9ca3af,#e5e7eb); color: #000; font-weight: 700; font-size: 12px; }
    .btn { appearance: none; border: none; padding: 10px 16px; border-radius: 999px; color: #fff; font-weight: 700; cursor: pointer; box-shadow: var(--shadow); }
    .btn-blue { background: linear-gradient(135deg,#2563eb,#60a5fa); }
    .btn-gray { background: linear-gradient(135deg,#6b7280,#9ca3af); color:#0b1020; }
    .actions { display:flex; gap:10px; flex-wrap: wrap; margin-top: 12px; align-items:center; }
    .muted { color: var(--muted); font-size: 12px; }

    /* Results card */
    pre.results {
      margin: 0; padding: 14px; background: #0b1020; color: #c7d2fe;
      border-radius: 14px; min-height: 180px; overflow: auto; white-space: pre-wrap; word-break: break-word;
    }

    /* Simple table for forecast */
    table.forecast { width:100%; border-collapse: collapse; }
    table.forecast th, table.forecast td { padding: 8px; text-align: left; }
    table.forecast thead { background: rgba(17,24,39,0.06); }
    table.forecast tbody tr + tr td { border-top: 1px dashed var(--line); }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <a class="brand" href="/index.html" aria-label="Back to PredictWell Health.ai home">
        <div class="brand-logo" aria-hidden="true"></div>
        <div>
          <div class="brand-title"><span class="hi">PredictWell Health</span><span class="ai">.ai</span></div>
          <div class="brand-tagline">Proactive health insights for seniors & athletes</div>
        </div>
      </a>
      <div class="spacer"></div>
      <button class="hamburger" id="menuBtn" aria-label="Open menu"></button>
      <nav class="menu" id="menu">
        <a href="/eldercare.html">Eldercare — Doctors</a>
        <a href="/eldercare-patient.html"><strong>Eldercare — Patients</strong></a>
        <a href="/athletics.html">Athletics — Doctors</a>
        <a href="/athletics-patient.html">Athletics — Patients</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <!-- Banner -->
    <section class="hero">
      <h1>Eldercare Sentinel — Patient Check-in</h1>
      <p>Answer a few quick questions. We’ll compute your <strong>nowcast</strong> and a <strong>2–4 week outlook</strong> so you can take simple steps to stay safer.</p>
      <div class="inline" style="margin-top:10px;">
        <span class="chip">Patient Portal</span>
        <span class="chip" id="backendStatus">Checking backend…</span>
      </div>
    </section>

    <!-- ========= PATIENT CHECK-IN ========= -->
    <section class="section">
      <h2>Daily Check-in</h2>
      <form id="patientForm" onsubmit="event.preventDefault(); runCheckin();">
        <div class="grid-3">
          <div class="field"><label for="patient_id">Patient ID</label><input id="patient_id" type="text" placeholder="e.g., TEST001" /></div>
          <div class="field"><label for="steps_baseline">Personal steps baseline (avg/day)</label><input id="steps_baseline" type="number" min="0" step="1" placeholder="7000" /></div>
          <div class="field"><label for="steps_7d">Steps (last 7 days avg)</label><input id="steps_7d" type="number" min="0" step="1" placeholder="5200" /></div>
        </div>

        <div class="grid-3" style="margin-top:12px;">
          <div class="field"><label for="sleep_frag">Sleep fragmentation (0–1)</label><input id="sleep_frag" type="number" min="0" max="1" step="0.01" placeholder="0.35" /></div>
          <div class="field"><label for="dizziness">Dizziness</label><select id="dizziness"><option value="0">No</option><option value="1">Yes</option></select></div>
          <div class="field"><label for="orthostatic_drop">Orthostatic drop</label><select id="orthostatic_drop"><option value="0">No</option><option value="1">Yes</option></select></div>
        </div>

        <div class="grid-3" style="margin-top:12px;">
          <div class="field"><label for="recent_fall">Recent fall</label><select id="recent_fall"><option value="0">No</option><option value="1">Yes</option></select></div>
          <div class="field"><label for="gait_flag">Gait issues</label><select id="gait_flag"><option value="0">No</option><option value="1">Yes</option></select></div>
          <div class="field"><label for="med_change">Medication change</label><select id="med_change"><option value="0">No</option><option value="1">Yes</option></select></div>
        </div>

        <div class="grid-3" style="margin-top:12px;">
          <div class="field"><label for="hydration_low">Low hydration</label><select id="hydration_low"><option value="0">No</option><option value="1">Yes</option></select></div>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-blue" id="runBtn">Get Results</button>
          <button type="reset" class="btn btn-gray">Reset</button>
          <span class="muted" id="saveStatus"></span>
        </div>
      </form>
    </section>

    <!-- ========= RESULTS ========= -->
    <section class="section" id="resultsCard">
      <h2>Your Results</h2>

      <!-- Plain-English summary -->
      <div id="summaryCard" style="display:none; background: rgba(255,255,255,0.9); border:1px solid var(--line); border-radius:14px; padding:14px; margin-bottom:12px;">
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:6px;">
          <span id="badge" class="chip">Risk: <strong id="riskBand">—</strong></span>
          <span class="chip">Score: <strong id="riskScore">0%</strong></span>
        </div>
        <div id="humanSummary" style="color:#0b1020; font-weight:600;">We’ll show your personalized summary here.</div>
        <ul id="actionsList" style="margin:8px 0 0 16px;"></ul>
      </div>

      <!-- Outlook -->
      <div id="outlook" style="display:none; background: rgba(255,255,255,0.9); border:1px solid var(--line); border-radius:14px; padding:14px; margin-bottom:12px;">
        <h3 style="margin:0 0 6px 0;">2–4 Week Outlook</h3>
        <div id="trendLabel" style="font-weight:800; margin-bottom:6px;"></div>
        <table class="forecast">
          <thead><tr><th>Week</th><th>Predicted</th><th>Low</th><th>High</th></tr></thead>
          <tbody id="forecastBody"></tbody>
        </table>
        <div id="signals" style="margin-top:8px;"></div>
      </div>

      <!-- Raw JSON -->
      <pre class="results" id="resultsBox">{ "status": "ready" }</pre>
    </section>

    <div class="footer">© 2025 PredictWell Health.ai — Eldercare</div>
  </div>

  <script>
    // ===== Config (match doctor page deployment) =====
    const BASE_API = 'https://predictwell-backend-ai.onrender.com';

    // Header menu toggle
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    document.addEventListener('click', (e) => {
      if (menuBtn.contains(e.target)) menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
      else if (!menu.contains(e.target)) menu.style.display = 'none';
    });

    // Backend ping
    async function pingBackend(){
      const el = document.getElementById('backendStatus');
      try{
        const r = await fetch(`${BASE_API}/healthz`, {cache:'no-store'});
        el.textContent = r.ok ? 'Backend: ok' : 'Backend: down';
        el.style.color = r.ok ? '#065f46' : '#991b1b';
      }catch{ el.textContent = 'Backend: down'; el.style.color = '#991b1b'; }
    }
    pingBackend();

    // Helpers
    const $ = (id)=>document.getElementById(id);
    const pct = (x)=>Math.round(Number(x||0)*100);
    function bandFor(score){ if(score>=0.60) return 'High'; if(score>=0.30) return 'Moderate'; return 'Low'; }
    function bandColor(b){ return b==='High' ? '#7f1d1d' : b==='Moderate' ? '#92400e' : '#065f46'; }
    function friendly(level){
      if(level==='High') return 'You have several risk signs. Simple steps at home and a quick check-in with your doctor can lower your risk.';
      if(level==='Moderate') return 'You have a few risk signs. Small daily habits can make a big difference.';
      return 'Great news — your answers suggest a low risk. Keep up your healthy habits.';
    }

    function collect(){
      const val = id => $(id)?.value;
      const num = id => { const v = val(id); return v==='' || v==null ? null : Number(v); };
      const intSel = id => Number(val(id) || 0);

      return {
        patient_id: (val('patient_id') || 'WEB-DEMO').trim(),
        steps_baseline: num('steps_baseline'),
        steps_7d: num('steps_7d'),
        sleep_frag: num('sleep_frag'),
        dizziness: intSel('dizziness'),
        orthostatic_drop: intSel('orthostatic_drop'),
        recent_fall: intSel('recent_fall'),
        gait_flag: intSel('gait_flag'),
        med_change: intSel('med_change'),
        hydration_low: intSel('hydration_low')
      };
    }

    function renderNowcast(now){
      $('summaryCard').style.display = 'block';
      const band = now.risk_band || '—';
      const score = typeof now.risk_score==='number' ? now.risk_score : 0;
      $('riskBand').textContent = band;
      $('riskBand').style.color = bandColor(band);
      $('riskScore').textContent = `${pct(score)}%`;
      $('humanSummary').textContent = friendly(band);

      const list = $('actionsList'); list.innerHTML = '';
      (now.top_factors || []).forEach(f=>{
        const li = document.createElement('li');
        li.textContent = `${f.factor.replaceAll('_',' ')} (+${f.contribution})`;
        list.appendChild(li);
      });
    }

    function renderForecast(fc){
      $('outlook').style.display = 'block';
      $('trendLabel').textContent = `Trend: ${fc.trend_label || '—'}`;

      const tb = $('forecastBody'); tb.innerHTML = '';
      (fc.weeks || []).forEach(w=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>Week ${w.week_ahead}</td><td>${pct(w.pred)}%</td><td>${pct(w.low)}%</td><td>${pct(w.high)}%</td>`;
        tb.appendChild(tr);
      });

      const sig = $('signals'); sig.innerHTML = '';
      if(Array.isArray(fc.signals) && fc.signals.length){
        const ul = document.createElement('ul');
        fc.signals.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; ul.appendChild(li); });
        sig.appendChild(ul);
      }else{
        const div=document.createElement('div'); div.style.opacity=.75; div.textContent='No slowing signals detected.'; sig.appendChild(div);
      }
    }

    async function runCheckin(){
      const results = $('resultsBox');
      const payload = collect();
      results.textContent = 'Analyzing…';

      try{
        const res = await fetch(`${BASE_API}/eldercare/checkin`, {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        results.textContent = JSON.stringify(json, null, 2);

        if(json.nowcast) renderNowcast(json.nowcast);
        if(json.forecast) renderForecast(json.forecast);
      }catch(e){
        results.textContent = JSON.stringify({ error:'Request failed or backend unreachable' }, null, 2);
      }
    }

    document.getElementById('runBtn').addEventListener('click', runCheckin);
  </script>
</body>
</html>

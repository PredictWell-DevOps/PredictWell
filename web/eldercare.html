<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PredictWell Health.ai — Eldercare Sentinel</title>
  <meta name="description" content="PredictWell Eldercare Sentinel: preventive health signals, check-ins, and gentle daily actions." />
  <link rel="icon" href="data:," />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background-image: url("/static/images/predictwell_background.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
      color: #0f172a;
    }
    .overlay { background: rgba(255,255,255,0.9); padding: 30px; min-height: 100vh; }

    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .brand h1 { margin: 0; font-size: 28px; color: #0b2545; }
    .brand span { color: #ff7a18; }
    nav a { text-decoration: none; color: #0b2545; font-weight: 700; padding: 8px 12px; border-radius: 8px; background: rgba(255,255,255,0.6); border: 1px solid rgba(2,6,23,0.1); }

    .card { background: #fff; border-radius: 14px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
    label { display: block; margin-bottom: 6px; color: #475569; }
    input, textarea { width: 100%; padding: 10px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #cbd5e1; box-sizing: border-box; }
    button { padding: 10px 16px; font-size: 15px; font-weight: 700; border-radius: 8px; border: none; cursor: pointer; }
    .primary { background: #ff7a18; color: #fff; }
    .ghost { background: #fff; color: #0b2545; border: 1px solid #94a3b8; }
    pre { background: #0b1220; color: #e2e8f0; padding: 14px; border-radius: 8px; overflow-x: auto; }
    footer { text-align: center; font-size: 12px; color: #475569; margin-top: 30px; }
  </style>
</head>
<body>
  <div class="overlay">
    <header>
      <div class="brand"><h1>PredictWell <span>Health.ai</span></h1></div>
      <nav>
        <a href="/eldercare.html">Eldercare</a>
        <a href="/athletics.html">Athletics</a>
      </nav>
    </header>

    <div class="card">
      <h2>Eldercare Sentinel — Weekly Check-In</h2>

      <label>Name</label>
      <input id="name" type="text" placeholder="e.g., Pat Quinn" />

      <label>Age</label>
      <input id="age" type="number" min="30" max="120" placeholder="79" />

      <label>Avg nightly SpO₂ (%)</label>
      <input id="avg_spo2" type="number" step="0.1" min="50" max="100" placeholder="94.5" />

      <label>HRV (RMSSD, ms)</label>
      <input id="hrv_rmssd" type="number" step="1" placeholder="18" />

      <label>Resting HR (bpm)</label>
      <input id="resting_hr" type="number" step="1" placeholder="70" />

      <label>Avg sleep (hours)</label>
      <input id="sleep_hours" type="number" step="0.1" placeholder="7" />

      <label>Avg daily steps</label>
      <input id="steps_daily" type="number" step="1" placeholder="3000" />

      <label><input id="gait_concern" type="checkbox" /> Any balance or dizziness issues?</label>
      <label><input id="cognitive_flags" type="checkbox" /> Any memory or attention concerns?</label>

      <label>Notes (optional)</label>
      <textarea id="notes" placeholder="Any changes this week?"></textarea>

      <div>
        <button class="primary" id="submitBtn">Submit Check-In</button>
        <button class="ghost" id="pingBtn">Ping Backend</button>
      </div>
    </div>

    <div class="card">
      <h3>Results</h3>
      <pre id="output">{ Submit to see results... }</pre>
    </div>

    <footer>© <span id="year"></span> PredictWell Health.ai — Eldercare Sentinel</footer>
  </div>

  <script>
    const BASE_API = 'https://predictwell-backend-ai.onrender.com';

    const out = (obj) => {
      const el = document.getElementById('output');
      el.textContent = (typeof obj === 'string') ? obj : JSON.stringify(obj, null, 2);
    };

    async function ping() {
      try {
        const r = await fetch(`${BASE_API}/healthz`, { cache: 'no-store' });
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        out(await r.json());
      } catch (e) { out({ error: String(e) }); }
    }

    // Shows a full, useful result immediately (server id + submitted payload)
    async function submitCheckin() {
      const payload = {
        name: document.getElementById('name').value,
        age: Number(document.getElementById('age').value),
        metrics: {
          spo2_avg: Number(document.getElementById('avg_spo2').value),
          hrv_rmssd: Number(document.getElementById('hrv_rmssd').value),
          resting_hr: Number(document.getElementById('resting_hr').value),
          sleep_hours: Number(document.getElementById('sleep_hours').value),
          steps_daily: Number(document.getElementById('steps_daily').value)
        },
        flags: {
          gait_concern: document.getElementById('gait_concern').checked,
          cognitive_flags: document.getElementById('cognitive_flags').checked
        },
        notes: document.getElementById('notes').value,
        timestamp: new Date().toISOString()
      };

      try {
        out('Submitting...');
        const res = await fetch(`${BASE_API}/eldercare/checkin`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const serverResp = await res.json(); // likely { id: N }

        // Display full record for the user NOW
        const display = {
          id: (serverResp && typeof serverResp.id !== 'undefined') ? serverResp.id : null,
          ...payload
        };
        out(display);
      } catch (err) { out({ error: String(err) }); }
    }

    document.getElementById('submitBtn').addEventListener('click', submitCheckin);
    document.getElementById('pingBtn').addEventListener('click', ping);
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>

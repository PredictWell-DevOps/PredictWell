<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eldercare — Patient Portal | PredictWell Health.ai</title>
  <meta name="description" content="Simple Eldercare patient check-in with a friendly result." />
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#0a0f1a; --panel:#0f1725ee; --muted:#8aa0b3; --text:#e9f1f7;
      --brand:#63e6be; --brand2:#5aa6ff; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{margin:0;height:100%;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    body::before{content:"";position:fixed;inset:0;background-image:url("/static/images/predictwell_background.png");background-size:cover;background-position:center;filter:brightness(.7);z-index:-2}
    body::after{content:"";position:fixed;inset:0;background:linear-gradient(180deg, rgba(10,15,26,.55), rgba(10,15,26,.85));z-index:-1}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    .top{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .logo{height:22px;width:22px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--brand2))}
    h1{margin:0}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-weight:600;font-size:.95rem}
    input,select,textarea{width:100%;padding:11px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
    textarea{min-height:88px;resize:vertical}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .btn{padding:12px 16px;border-radius:14px;border:1px solid transparent;cursor:pointer;font-weight:700}
    .primary{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#07111f}
    .ghost{background:transparent;border-color:rgba(255,255,255,.12);color:#e7f4ff}
    .muted{color:var(--muted);font-size:.95rem}
    .result{margin-top:16px;display:none}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="logo"></div>
      <div><strong>PredictWell Health</strong> · <a href="/">Home</a></div>
    </div>

    <div class="card">
      <h1 style="margin-top:0">Eldercare — Patient Check-In</h1>
      <p class="muted">Takes ~60 seconds. Your answers help your care team spot early risks.</p>

      <form id="form" class="grid">
        <div>
          <label>Age</label>
          <input type="number" id="age" min="40" max="110" placeholder="e.g., 79" required>
        </div>
        <div>
          <label>Average nightly SpO₂ (%)</label>
          <input type="number" id="spo2" min="70" max="100" placeholder="e.g., 94">
        </div>
        <div>
          <label>Steps yesterday</label>
          <input type="number" id="steps" min="0" max="50000" placeholder="e.g., 3200">
        </div>
        <div>
          <label>Sleep last night (hours)</label>
          <input type="number" step="0.1" id="sleep" min="0" max="14" placeholder="e.g., 6.5">
        </div>
        <div>
          <label>Any fall in the past 30 days?</label>
          <select id="falls">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
        <div>
          <label>Dizziness or unsteadiness this week?</label>
          <select id="dizzy">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
        <div>
          <label>New or changed medications this week?</label>
          <select id="meds">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
        <div>
          <label>New pain (moderate or more)?</label>
          <select id="pain">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
        <div class="full">
          <label>Notes (optional)</label>
          <textarea id="notes" placeholder="Anything else you'd like to share?"></textarea>
        </div>
        <div class="full actions">
          <button type="submit" class="btn primary">Get My Result</button>
          <button type="button" id="reset" class="btn ghost">Reset</button>
        </div>
      </form>

      <div id="result" class="result">
        <div class="pill" id="riskBadge">Risk: —</div>
        <p id="summary" style="margin-top:10px"></p>
        <p class="muted" style="margin-top:8px">This is a quick orientation view — not a diagnosis. If you feel unwell, contact your clinician or emergency services.</p>
      </div>
    </div>
  </div>

  <script>
    const BASE_API = 'https://predictwell-backend-ai.onrender.com';

    const form = document.getElementById('form');
    const resultBox = document.getElementById('result');
    const riskBadge = document.getElementById('riskBadge');
    const summary = document.getElementById('summary');

    document.getElementById('reset').onclick = () => { form.reset(); resultBox.style.display='none'; };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        age: num('age'),
        spo2_avg: num('spo2'),
        steps: num('steps'),
        sleep_hours: num('sleep'),
        falls_last_30d: val('falls'),
        dizziness: val('dizzy'),
        meds_change: val('meds'),
        pain: val('pain'),
        notes: document.getElementById('notes').value?.trim() || null
      };

      // Try backend first
      let ok = false;
      try {
        const res = await fetch(`${BASE_API}/eldercare/checkin`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (res.ok) {
          const data = await res.json();
          // Expecting something like { risk_score, level, message }
          const level = data.level || levelFromScore(data.risk_score);
          render(level, data.message || autoMessage(payload, level));
          ok = true;
        }
      } catch (err) { /* fall through to local estimate */ }

      // Fallback (local quick estimate)
      if (!ok) {
        const level = localEstimate(payload);
        render(level, autoMessage(payload, level), true);
      }
    });

    function val(id){ return document.getElementById(id).value; }
    function num(id){ const v = document.getElementById(id).value; return v===""?null:Number(v); }

    function levelFromScore(s){
      if (s==null) return 'Unknown';
      if (s >= 0.66) return 'High';
      if (s >= 0.33) return 'Moderate';
      return 'Low';
    }

    function localEstimate(p){
      let score = 0;
      if (p.falls_last_30d==='yes') score += 0.4;
      if (p.dizziness==='yes') score += 0.25;
      if (p.meds_change==='yes') score += 0.15;
      if (p.pain==='yes') score += 0.15;
      if (p.spo2_avg!=null && p.spo2_avg < 92) score += 0.15;
      if (p.steps!=null && p.steps < 1500) score += 0.1;
      if (p.sleep_hours!=null && p.sleep_hours < 5.5) score += 0.1;
      if (score >= 0.66) return 'High';
      if (score >= 0.33) return 'Moderate';
      return 'Low';
    }

    function autoMessage(p, level){
      const bits = [];
      if (p.falls_last_30d==='yes') bits.push('recent fall');
      if (p.dizziness==='yes') bits.push('dizziness/unstable');
      if (p.meds_change==='yes') bits.push('medication change');
      if (p.pain==='yes') bits.push('new pain');
      if (p.spo2_avg!=null && p.spo2_avg<92) bits.push('low oxygen');
      if (p.steps!=null && p.steps<1500) bits.push('very low activity');
      if (p.sleep_hours!=null && p.sleep_hours<5.5) bits.push('short sleep');
      const because = bits.length ? `Because of ${bits.join(', ')}.` : '';
      return `Your quick risk looks **${level}**. ${because} Please share this with your clinician if concerned.`;
    }

    function render(level, msg, fallback=false){
      riskBadge.textContent = `Risk: ${level}${fallback ? ' (quick estimate)' : ''}`;
      summary.innerHTML = msg;
      resultBox.style.display = 'block';
      resultBox.scrollIntoView({behavior:'smooth', block:'start'});
    }
  </script>
</body>
</html>
